<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª - Ú©Ø§ÙÙ‡ ØªÛŒØ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Tahoma, Arial, sans-serif;
            background: #f5f5f5;
            direction: rtl;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .editor-panel {
            width: 50%;
            background: white;
            padding: 20px;
            overflow-y: auto;
            border-left: 2px solid #e0e0e0;
        }

        .preview-panel {
            width: 50%;
            background: #f9f9f9;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: Tahoma, Arial, sans-serif;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .image-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: #667eea;
            background: #f9f9ff;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .menu-item-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-tab.active {
            background: #667eea;
            color: white;
        }

        .preview-frame {
            width: 100%;
            height: calc(100vh - 100px);
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .status-message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editor-panel">
            <div class="header">
                <h1>ğŸ¨ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙÙ‡ ØªÛŒØ§</h1>
                <p>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØªÙˆØ§ Ùˆ Ù…Ù†ÙˆÛŒ Ø³Ø§ÛŒØª</p>
            </div>

            <div id="statusMessage" class="status-message"></div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
            </div>

            <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ -->
            <div class="section">
                <div class="section-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</div>
                
                <div class="form-group">
                    <label>ØªØµÙˆÛŒØ± Ù‡ÛŒØ±Ùˆ</label>
                    <div class="image-upload" onclick="document.getElementById('heroImgInput').click()">
                        <p>ğŸ“· Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ÛŒØ§ ØªØµÙˆÛŒØ± Ø±Ø§ Ø¨Ú©Ø´ÛŒØ¯</p>
                        <input type="file" id="heroImgInput" accept="image/*" style="display:none;" onchange="handleImageUpload('hero', this)">
                        <img id="heroImgPreview" class="image-preview" style="display:none;">
                    </div>
                    <input type="text" id="heroImg" placeholder="/img/interior-cafe.jpg">
                </div>

                <div class="form-group">
                    <label>Ù„ÛŒÙ†Ú© Ù„ÙˆÚ©ÛŒØ´Ù† (Google Maps)</label>
                    <input type="text" id="location" placeholder="geo:35.849187,50.981813">
                </div>

                <div class="form-group">
                    <label>Ù„ÛŒÙ†Ú© Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</label>
                    <input type="text" id="instagram" placeholder="https://instagram.com/tia_.cafe">
                </div>
            </div>

            <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ -->
            <div class="section">
                <div class="section-title">ğŸ“‹ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ</div>
                
                <div class="category-tabs" id="categoryTabs"></div>
                
                <div id="menuItemsContainer"></div>
                
                <button class="btn btn-success" onclick="addNewItem()">â• Ø§ÙØ²ÙˆØ¯Ù† Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯</button>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="saveChanges()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
                <button class="btn" onclick="loadData()">ğŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯</button>
            </div>
        </div>

        <div class="preview-panel">
            <div class="header">
                <h2>ğŸ‘ï¸ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</h2>
                <select id="previewMode" onchange="updatePreview()" style="padding: 8px; border-radius: 5px; margin-top: 10px;">
                    <option value="index">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</option>
                    <option value="menu">ØµÙØ­Ù‡ Ù…Ù†Ùˆ</option>
                </select>
            </div>
            <iframe id="previewFrame" class="preview-frame"></iframe>
        </div>
    </div>

    <script>
        let contentData = null;
        let currentCategory = 'espressobar';
        const GITHUB_REPO = 'YOUR_USERNAME/YOUR_REPO'; // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯
        const GITHUB_TOKEN = 'YOUR_GITHUB_TOKEN'; // Ø§Ø² Netlify Environment Variables

        async function loadData() {
            showLoading(true);
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/data/content.json`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                const data = await response.json();
                const content = atob(data.content);
                contentData = JSON.parse(content);
                contentData.sha = data.sha; // Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª Ù†ÛŒØ§Ø² Ø§Ø³Øª
                
                populateForm();
                showMessage('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'success');
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function populateForm() {
            document.getElementById('heroImg').value = contentData.homepage.heroImg;
            document.getElementById('location').value = contentData.homepage.location;
            document.getElementById('instagram').value = contentData.homepage.instagram;
            
            renderCategoryTabs();
            renderMenuItems();
            updatePreview();
        }

        function renderCategoryTabs() {
            const container = document.getElementById('categoryTabs');
            container.innerHTML = '';
            
            contentData.menu.categories.forEach(cat => {
                const tab = document.createElement('button');
                tab.className = 'category-tab' + (cat.id === currentCategory ? ' active' : '');
                tab.textContent = cat.nameFA;
                tab.onclick = () => {
                    currentCategory = cat.id;
                    renderCategoryTabs();
                    renderMenuItems();
                };
                container.appendChild(tab);
            });
        }

        function renderMenuItems() {
            const container = document.getElementById('menuItemsContainer');
            container.innerHTML = '';
            
            const category = contentData.menu.categories.find(c => c.id === currentCategory);
            if (!category) return;
            
            category.items.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'menu-item-card';
                card.innerHTML = `
                    <div class="menu-item-header">
                        <strong>${item.nameFA || 'Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯'}</strong>
                        <button class="btn btn-danger" onclick="deleteItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Ù†Ø§Ù… ÙØ§Ø±Ø³ÛŒ</label>
                        <input type="text" value="${item.nameFA}" onchange="updateItem(${index}, 'nameFA', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</label>
                        <input type="text" value="${item.nameEN}" onchange="updateItem(${index}, 'nameEN', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>ØªØµÙˆÛŒØ±</label>
                        <div class="image-upload" onclick="document.getElementById('itemImg${index}').click()">
                            <p>ğŸ“· Ø§Ù†ØªØ®Ø§Ø¨ ØªØµÙˆÛŒØ±</p>
                            <input type="file" id="itemImg${index}" accept="image/*" style="display:none;" onchange="handleImageUpload('item${index}', this)">
                            ${item.img ? `<img src="${item.img}" class="image-preview">` : ''}
                        </div>
                        <input type="text" value="${item.img}" onchange="updateItem(${index}, 'img', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Ù‚ÛŒÙ…Øª ØªÚ© Ø´Ø§Øª</label>
                        <input type="text" value="${item.price1 || ''}" onchange="updateItem(${index}, 'price1', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Ù‚ÛŒÙ…Øª Ø¯Ùˆ Ø´Ø§Øª</label>
                        <input type="text" value="${item.price2 || ''}" onchange="updateItem(${index}, 'price2', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <textarea onchange="updateItem(${index}, 'description', this.value)">${item.description || ''}</textarea>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateItem(index, field, value) {
            const category = contentData.menu.categories.find(c => c.id === currentCategory);
            category.items[index][field] = value;
            updatePreview();
        }

        function deleteItem(index) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            const category = contentData.menu.categories.find(c => c.id === currentCategory);
            category.items.splice(index, 1);
            renderMenuItems();
            updatePreview();
        }

        function addNewItem() {
            const category = contentData.menu.categories.find(c => c.id === currentCategory);
            category.items.push({
                id: 'new-item-' + Date.now(),
                nameFA: 'Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯',
                nameEN: 'New Item',
                img: '/img/icon-menu.svg',
                price1: '',
                price2: '',
                description: ''
            });
            renderMenuItems();
        }

        function handleImageUpload(type, input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById(type + 'Preview') || input.parentElement.querySelector('.image-preview');
                if (preview) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                
                // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ ØªØµÙˆÛŒØ± Ø±Ø§ Ø¨Ù‡ GitHub Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ ÙÙ‚Ø· Base64 Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
                showMessage('ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯. Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù‡Ø§ÛŒÛŒØŒ Ø¯Ú©Ù…Ù‡ "Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.', 'success');
            };
            reader.readAsDataURL(file);
        }

        async function saveChanges() {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÙØ±Ù…
            contentData.homepage.heroImg = document.getElementById('heroImg').value;
            contentData.homepage.location = document.getElementById('location').value;
            contentData.homepage.instagram = document.getElementById('instagram').value;
            
            showLoading(true);
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/data/content.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update content via admin panel',
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(contentData, null, 2)))),
                        sha: contentData.sha
                    })
                });
                
                const data = await response.json();
                contentData.sha = data.content.sha;
                
                showMessage('âœ… ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! GitHub Actions Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª Ø³Ø§ÛŒØª Ø§Ø³Øª...', 'success');
            } catch (error) {
                showMessage('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function updatePreview() {
            const mode = document.getElementById('previewMode').value;
            const frame = document.getElementById('previewFrame');
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Øª
            if (mode === 'index') {
                frame.srcdoc = generateIndexPreview();
            } else {
                frame.srcdoc = generateMenuPreview();
            }
        }

        function generateIndexPreview() {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Tahoma; text-align: center; padding: 20px; direction: rtl; }
                        img { max-width: 100%; height: auto; border-radius: 10px; }
                        .links { margin: 20px 0; }
                        a { display: block; margin: 10px; padding: 10px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; }
                    </style>
                </head>
                <body>
                    <h1>Ú©Ø§ÙÙ‡ ØªÛŒØ§</h1>
                    <img src="${contentData.homepage.heroImg}" alt="Hero">
                    <div class="links">
                        <a href="${contentData.homepage.location}">ğŸ“ Ù„ÙˆÚ©ÛŒØ´Ù† Ú©Ø§ÙÙ‡</a>
                        <a href="${contentData.homepage.instagram}">ğŸ“¸ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ù…Ø§</a>
                    </div>
                </body>
                </html>
            `;
        }

        function generateMenuPreview() {
            const category = contentData.menu.categories.find(c => c.id === currentCategory);
            let itemsHTML = '';
            
            category.items.forEach(item => {
                itemsHTML += `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                        <img src="${item.img}" style="width: 56px; height: 56px;">
                        <h3>${item.nameFA}</h3>
                        <p>${item.nameEN}</p>
                        ${item.price1 ? `<p>ØªÚ© Ø´Ø§Øª: ${item.price1}</p>` : ''}
                        ${item.price2 ? `<p>Ø¯Ùˆ Ø´Ø§Øª: ${item.price2}</p>` : ''}
                        ${item.description ? `<p style="font-size: 12px; color: #666;">${item.description}</p>` : ''}
                    </div>
                `;
            });
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Tahoma; padding: 20px; direction: rtl; }
                        h2 { color: #667eea; }
                    </style>
                </head>
                <body>
                    <h2>${category.nameFA}</h2>
                    ${itemsHTML}
                </body>
                </html>
            `;
        }

        function showMessage(message, type) {
            const el = document.getElementById('statusMessage');
            el.textContent = message;
            el.className = 'status-message status-' + type;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = () => {
            loadData();
        };
    </script>
</body>
</html>